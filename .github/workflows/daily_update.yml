name: Daily Content Update

on:
  schedule:
    # Runs at 00:00 UTC (08:00 Beijing Time) every day
    - cron: '0 0 * * *'
  workflow_dispatch: # Allows manual trigger

jobs:
  fetch-and-update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests supabase

      - name: Fetch and Upload Data
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        run: |
          # 1. Convenient Daily Apps & Websites (Tools, Productivity, CLI)
          echo "Fetching Productivity & Tools..."
          python scripts/fetch_github_trending.py --language "python" --limit 5 --upload
          python scripts/fetch_github_trending.py --language "javascript" --limit 5 --upload
          python scripts/fetch_github_trending.py --language "go" --limit 5 --upload

          # 2. Vercel Deployable (Next.js, React, Node)
          echo "Fetching Vercel/Web Projects..."
          python scripts/fetch_github_trending.py --language "typescript" --limit 8 --upload
          python scripts/fetch_github_trending.py --language "vue" --limit 3 --upload

          # 3. AI Frontier (Python, Jupyter, AI frameworks)
          echo "Fetching AI Projects..."
          python scripts/fetch_github_trending.py --language "jupyter-notebook" --limit 5 --upload
          # Note: AI projects are often Python, covered above, but we can search specific topics if we enhance the script later.
          # For now, general Python trending often covers AI.

          # 4. Beautiful Frontend Design (CSS, Design systems)
          echo "Fetching Design & UI..."
          python scripts/fetch_github_trending.py --language "css" --limit 3 --upload
          python scripts/fetch_github_trending.py --language "html" --limit 3 --upload
          python scripts/fetch_github_trending.py --language "dart" --limit 5 --upload # Flutter for UI

          # 5. Vibe Coding (Creative coding, Art) - often JS/Processing/Shaders
          echo "Fetching Creative/Vibe Projects..."
          # Since 'vibe-coding' isn't a language, we broaden the search with likely languages
          python scripts/fetch_github_trending.py --language "glsl" --limit 3 --upload # Shaders
